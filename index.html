<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Controle de Despesas v2.0</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

    :root {
      --bg-color: #f8f9fa;
      --surface-color: #ffffff;
      --text-color-primary: #000000;
      --text-color-secondary: #495057;
      --border-color: #dee2e6;
      --accent-color: #007bff;
      --accent-color-hover: #0056b3;
      --nubank-color: #820ad1;
      --c6-color: #2b2b2b;
      --success-color: #28a745;
      --danger-color: #dc3545;
      --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.04);
      --shadow-md: 0 3px 6px rgba(0, 0, 0, 0.07);
      --border-radius: 6px;
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color-primary);
      margin: 0;
      padding: 24px;
      font-size: 14px;
    }

    .container {
      max-width: 1200px;
      margin: auto;
      padding: 0;
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
    }

    .month-navigation {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 20px;
      gap: 10px;
    }

    .month-navigation button {
      background: var(--accent-color);
      color: #fff;
      border: none;
      padding: 6px 12px;
      border-radius: var(--border-radius);
      cursor: pointer;
    }

    .grid-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    .grid-item {
      background: var(--surface-color);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      padding: 16px;
      box-shadow: var(--shadow-sm);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    th, td {
      border: 1px solid var(--border-color);
      padding: 8px;
      text-align: left;
    }

    tfoot td {
      font-weight: bold;
    }

    .summary-box {
      text-align: center;
      margin: 20px 0;
      font-size: 1.2rem;
      font-weight: bold;
    }

    #status {
      margin-top: 20px;
      text-align: center;
      color: var(--text-color-secondary);
    }

    /* Tela de Login */
    #loginScreen {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: var(--bg-color);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    #loginBox {
      background: var(--surface-color);
      padding: 24px;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-md);
      text-align: center;
    }
    #loginBox input {
      font-size: 1.2rem;
      padding: 8px;
      text-align: center;
      margin-bottom: 12px;
      width: 120px;
    }
    #loginBox button {
      background: var(--accent-color);
      color: #fff;
      padding: 8px 16px;
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
    }
    #loginError { color: var(--danger-color); margin-top: 8px; font-size: 0.9rem; }
  </style>
</head>
<body>

  <!-- Tela de Login -->
  <div id="loginScreen">
    <div id="loginBox">
      <h2>Digite a senha</h2>
      <input type="password" id="passwordInput" maxlength="12" pattern="[0-9]*" inputmode="numeric" />
      <br>
      <button id="loginBtn">Entrar</button>
      <div id="loginError"></div>
    </div>
  </div>

  <!-- App -->
  <div class="container" id="appContainer" style="display:none">
    <h1>Controle de Despesas</h1>

    <div class="month-navigation">
      <button id="prevMonthBtn">&lt;</button>
      <h2 id="currentMonthYear" style="border:none; margin:0;"></h2>
      <button id="nextMonthBtn">&gt;</button>
      <button id="migrateDataBtn">Migrar</button>
      <button id="saveDataBtn">Salvar</button>
      <button id="restoreDataBtn">Resgatar</button>
      <input type="file" id="restoreFileInput" accept=".txt,.json" style="display:none;">
    </div>

    <div class="summary-box">
      <h3>Total Geral</h3>
      <div id="totalGeral">R$ 0,00</div>
    </div>

    <div class="grid-container">
      <div class="grid-item">
        <h2>Despesas Fixas</h2>
        <table id="fixedExpensesTable">
          <thead><tr><th>Descrição</th><th>Valor (R$)</th><th>OK</th></tr></thead>
          <tbody></tbody>
          <tfoot><tr><td><b>Total Fixo</b></td><td id="fixedTotal">R$ 0,00</td><td></td></tr></tfoot>
        </table>
      </div>

      <div class="grid-item">
        <h2>Nubank</h2>
        <table id="nubankTable">
          <thead><tr><th>Descrição</th><th>Valor</th><th>Parcela</th><th>OK</th></tr></thead>
          <tbody></tbody>
          <tfoot><tr><td><b>Total Nubank</b></td><td id="nubankTotal" colspan="3">R$ 0,00</td></tr></tfoot>
        </table>
      </div>

      <div class="grid-item">
        <h2>C6 Bank</h2>
        <table id="c6Table">
          <thead><tr><th>Descrição</th><th>Valor</th><th>Parcela</th><th>OK</th></tr></thead>
          <tbody></tbody>
          <tfoot><tr><td><b>Total C6</b></td><td id="c6Total" colspan="3">R$ 0,00</td></tr></tfoot>
        </table>
      </div>
    </div>
  </div>

  <div id="status"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getDatabase } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";
    import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBiikcagIm1p7wJG6DsHijkvdy1fpDBn8Y",
      authDomain: "bd-teste-c931c.firebaseapp.com",
      databaseURL: "https://bd-teste-c931c-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "bd-teste-c931c",
      storageBucket: "bd-teste-c931c.appspot.com",
      messagingSenderId: "270308100761",
      appId: "1:270308100761:web:ae34fde6d5ae86b67b0608"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // --- LOGIN ---
    const loginBtn = document.getElementById('loginBtn');
    loginBtn.addEventListener('click', () => {
      const pass = document.getElementById('passwordInput').value;
      const emailFixo = "app@login.com"; // você deve cadastrar este e-mail no Firebase Authentication
      signInWithEmailAndPassword(auth, emailFixo, pass)
        .then(() => {
          document.getElementById('loginScreen').style.display = "none";
          document.getElementById('appContainer').style.display = "block";
        })
        .catch(() => {
          document.getElementById('loginError').textContent = "Senha incorreta";
        });
    });

    // --- Funções Tabela ---
    function addNewRow(tbody, focus=false) {
      const newRow = tbody.insertRow();
      const colCount = tbody.parentElement.tHead.rows[0].cells.length;
      for (let i=0; i<colCount; i++) {
        const cell = newRow.insertCell();
        if (i === colCount-1) {
          const chk = document.createElement("input");
          chk.type = "checkbox";
          cell.appendChild(chk);
        } else {
          cell.contentEditable = "true";
        }
      }
      if (focus) newRow.cells[0].focus();
    }

    function ensureEmptyRow(tbody) {
      if (!tbody.rows.length || [...tbody.rows[tbody.rows.length-1].cells].some(c=>c.textContent.trim()!=='')) {
        addNewRow(tbody);
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      ["fixedExpensesTable","nubankTable","c6Table"].forEach(id=>{
        const tb = document.getElementById(id).tBodies[0];
        ensureEmptyRow(tb);
        tb.addEventListener("input", ()=>ensureEmptyRow(tb));
      });
    });
  </script>
</body>
</html>
